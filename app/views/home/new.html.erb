<div class="main_container col-6">
  <div class="header_element d-flex justify-content-between align-items-center  p-2 mb-4">
    <%= link_to root_path  do %>
      <i class="bi bi-list h3 text-white"></i>
    <% end %>
    <h2>Depenses</h2>
    <div class="actions text-center mt-3">
      <%= form_tag destroy_user_session_path, method: :delete, class: "d-inline" do %>
        <%= button_to "Sign Out", destroy_user_session_path, method: :delete, class: "btn btn-danger" %>
      <% end %>
    </div>
  </div>
  <div class="container">
    <div class="container justify-content-center removedecoration">
      <% if @user_groups.present? %>
        <% @user_groups.each do |group| %>
          <%= link_to group_path(group) do %>
            <div class="col-md-12 my-2">
              <div class="card">
                <div class="card-body d-flex flex-row justify-content-between align-items-center">
                  <div class="col-3">
                    <img src="<%= group.icon %>" alt="Group Icon" class="bi-image" style="max-width: 100px;">
                  </div>
                  <div class="col-6 grisColor">
                    <h5 class="card-title "><%= group.name %></h5>
                    <% formatted_date = group.created_at.strftime("%e, %B %Y") %>
                    <span class="smallSpan"><%= formatted_date %></span>
                  </div>
                  <div class="col-3 blackColor">
                    <% total_depenses = group.depenses.sum(:amount) %>
                    <h3>$<%= total_depenses > 0 ? total_depenses : 0 %></h3>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      <% else %>
        <div class="col-md-12 text-center">
          <p>No groups available.</p>
        </div>
      <% end %>
    </div>
  </div>

  <% if user_signed_in? %>
    <div class="container addBtn actions text-center mt-3 fixed-bottom bg-success mx-auto py-3 col-5">
      <button type="button" class="btn btn-success col-11 bg-success  border-white" data-bs-toggle="modal" data-bs-target="#newGroupModal">
        Create New Group
      </button>
    </div>
  <% end %>


  <div class="modal fade" id="newGroupModal" tabindex="-1" aria-labelledby="newGroupModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <%= form_with model: @group, url: groups_path, method: :post do |form| %>
          <div class="modal-header">
            <h5 class="modal-title" id="newGroupModalLabel">Create New Group</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <%= form.label :name, class: "form-label" %>
              <%= form.text_field :name, class: "form-control" %>
            </div>
            <div class="mb-3">
              <%= form.label :icon, class: "form-label" %>
              <%= form.text_field :icon, class: "form-control" %>
            </div>
          </div>
          <div class="modal-footer">
            <%= form.submit "Create Group", class: "btn btn-primary" %>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
